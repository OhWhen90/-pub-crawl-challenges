<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes" />
  <title>Pub Crawl Challenge List</title>
  <style>
    body {
      font-family: sans-serif;
      font-size: 18px;
      max-width: 600px;
      margin: 0 auto;
      padding: 1rem;
      background: #f9f9f9;
      color: #222;
    }
    h1 {
      text-align: center;
      margin-bottom: 1rem;
    }
    label {
      display: flex;
      align-items: flex-start;
      padding: 0.6rem 0;
      font-size: 1.2rem;
      cursor: pointer;
    }
    input[type="checkbox"] {
      margin-right: 1rem;
      transform: scale(1.3);
      cursor: pointer;
    }
    .emoji {
      margin-right: 0.3rem;
      font-size: 1.4rem;
    }
    .challenge-title {
      font-weight: bold;
    }
    .challenge-desc {
      margin-left: 2.7rem;
      font-size: 1rem;
      color: #555;
      margin-top: -0.3rem;
    }
    .bonus, .rainbow {
      margin-left: 2.7rem;
      font-size: 0.95rem;
      color: #444;
    }
    .rainbow input[type="checkbox"],
    .bonus input[type="checkbox"] {
      transform: scale(1.1);
      margin-right: 0.4rem;
      cursor: pointer;
    }
    .rainbow label {
      display: inline-block;
      width: 48%;
      margin-top: 0.3rem;
    }
    #scoreboard {
      text-align: center;
      margin-top: 2rem;
      font-size: 1.2rem;
    }
  </style>
</head>
<body>

<h1>Pub Crawl Challenge List</h1>

<div id="challenge-container"></div>

<div id="scoreboard">
  <div id="main-count">‚úîÔ∏è Challenges Completed: 0 / 10</div>
  <div id="bonus-count">‚≠ê Bonus Points Earned: 0 / 10</div>
  <div id="total-score">üèÜ Total Score: 0 / 20</div>
</div>

<script>
  const challenges = [
    { id: 0, emojis: ["üîÅ", "üëï"], title: "Closet Shuffle.", desc: "Swap an item of clothing with someone for the entire time at one location." },
    { id: 1, emojis: ["üåà", "üçπ"], title: "Taste the Rainbow.", desc: "Drink two different colours of the rainbow ‚Äî use cocktails, shots, or even mixers.", rainbow: true },
    { id: 2, emojis: ["ü•§", "üç∏"], title: "The Diana Special.", desc: "Finish your entire drink using three (or more) straws at once." },
    { id: 3, emojis: ["üîô", "üö∂‚Äç‚ôÇÔ∏è"], title: "Backwards Journey.", desc: "Walk backwards between any two crawl stops. Safety first, though ‚Äî have a guide!" },
    { id: 4, emojis: ["üß¶", "‚úã"], title: "Sock Puppet Hour.", desc: "Wear a sock on your right hand for the entire time at one location. Introduce it as your new drinking buddy." },
    { id: 5, emojis: ["üï∫", "üíÉ"], title: "Dance-Off Destiny.", desc: "Join or start a dance-off.", bonus: "If you win or get strangers to cheer." },
    { id: 6, emojis: ["ü§´", "üìé"], title: "The Sneaky Peg.", desc: "Clip your peg on someone without them noticing ‚Äî it must stay there for 15 minutes. Proof required!", bonus: "Someone leaves a crawl stop wearing your peg.", bonusAlwaysEnabled: true },
    { id: 7, emojis: ["üé≠", "üó£Ô∏è"], title: "Accent Order (Encore).", desc: "Order your drink in a full accent (e.g. French, pirate, cowboy, Scottish).", bonus: "Stay in character until you have finished your drink." },
    { id: 8, emojis: ["üì∏", "ü§≥"], title: "The Hospitality Selfie.", desc: "Take a selfie with either a bartender or a bouncer.", bonus: "If they smile." },
    { id: 9, emojis: ["üçª", "ü•Ç"], title: "The Icebreaker Toast.", desc: "Walk up to a complete stranger (or another group) and confidently give a short but passionate toast in their honour.", bonus: "They toast back." }
  ];

  const rainbowColors = ["Red", "Orange", "Yellow", "Green", "Blue", "Indigo", "Violet"];
  const rainbowEmojis = {
    Red: "üî¥",
    Orange: "üü†",
    Yellow: "üü°",
    Green: "üü¢",
    Blue: "üîµ",
    Indigo: "üü£",
    Violet: "üü£"
  };

  function saveState(id, value) {
    localStorage.setItem(id, value ? "true" : "false");
  }

  function getState(id) {
    return localStorage.getItem(id) === "true";
  }

  function createChallenges() {
    const container = document.getElementById("challenge-container");
    container.innerHTML = "";
    challenges.forEach(ch => {
      const label = document.createElement("label");
      label.htmlFor = `chk${ch.id}`;
      label.style.flexDirection = "column";

      const topLine = document.createElement("div");
      topLine.style.display = "flex";
      topLine.style.alignItems = "center";

      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.id = `chk${ch.id}`;
      checkbox.checked = getState(`chk${ch.id}`);
      checkbox.style.marginRight = "1rem";
      checkbox.style.transform = "scale(1.3)";
      checkbox.style.cursor = "pointer";

      checkbox.addEventListener("change", () => {
        saveState(checkbox.id, checkbox.checked);
        updateScore();
        if(ch.id === 1) {
          // Disable manual checking of taste the rainbow
          checkbox.checked = false;
          saveState(checkbox.id, false);
        }
      });

      // Append emojis
      ch.emojis.forEach(e => {
        const span = document.createElement("span");
        span.className = "emoji";
        span.textContent = e;
        topLine.appendChild(span);
      });

      topLine.prepend(checkbox);
      label.appendChild(topLine);

      // Title and description
      const div = document.createElement("div");
      div.innerHTML = `<div class="challenge-title">${ch.title}</div><div class="challenge-desc">${ch.desc}</div>`;
      label.appendChild(div);

      // Rainbow colors checkboxes if applicable
      if (ch.rainbow) {
        const colorContainer = document.createElement("div");
        colorContainer.className = "rainbow";

        rainbowColors.forEach(color => {
          const cLabel = document.createElement("label");
          cLabel.style.display = "inline-block";
          cLabel.style.width = "48%";
          cLabel.style.marginTop = "0.3rem";

          const cCheckbox = document.createElement("input");
          cCheckbox.type = "checkbox";
          cCheckbox.id = `rainbow-${color}`;
          cCheckbox.checked = getState(`rainbow-${color}`);
          cCheckbox.style.cursor = "pointer";
          cCheckbox.addEventListener("change", () => {
            saveState(cCheckbox.id, cCheckbox.checked);
            updateScore();
          });

          cLabel.appendChild(cCheckbox);

          const emojiSpan = document.createElement("span");
          emojiSpan.className = "emoji";
          emojiSpan.textContent = rainbowEmojis[color];
          cLabel.appendChild(emojiSpan);

          const textNode = document.createTextNode(` ${color}`);
          cLabel.appendChild(textNode);

          colorContainer.appendChild(cLabel);
        });

        // Bonus note for rainbow
        const bonusNote = document.createElement("div");
        bonusNote.className = "bonus";
        bonusNote.style.marginTop = "0.3rem";
        bonusNote.textContent = "‚≠ê Bonus: Each additional colour beyond two.";
        colorContainer.appendChild(bonusNote);

        label.appendChild(colorContainer);
      }

      // Bonus challenge checkbox
      if (ch.bonus) {
        const bonusContainer = document.createElement("div");
        bonusContainer.className = "bonus";
        bonusContainer.style.marginLeft = "2.7rem";

        const bCheckbox = document.createElement("input");
        bCheckbox.type = "checkbox";
        bCheckbox.id = `chk${ch.id}b`;
        bCheckbox.checked = getState(`chk${ch.id}b`);
        bCheckbox.style.marginRight = "0.4rem";
        bCheckbox.style.transform = "scale(1.1)";
        bCheckbox.style.cursor = "pointer";

        // For sneaky peg bonusAlwaysEnabled = true => bonus can be checked anytime
        if(!ch.bonusAlwaysEnabled){
          bCheckbox.disabled = !getState(`chk${ch.id}`);
        }

        bCheckbox.addEventListener("change", () => {
          saveState(bCheckbox.id, bCheckbox.checked);
          updateScore();
        });

        bonusContainer.appendChild(bCheckbox);

        const bonusLabel = document.createElement("span");
        bonusLabel.textContent = `‚≠ê Bonus: ${ch.bonus}`;
        bonusContainer.appendChild(bonusLabel);

        label.appendChild(bonusContainer);
      }

      container.appendChild(label);
    });
  }

  function updateScore() {
    let main = 0;
    let bonus = 0;
    let rainbowCount = 0;

    // Count rainbow colors
    rainbowColors.forEach(color => {
      if(getState(`rainbow-${color}`)) rainbowCount++;
    });

    // Auto check Taste the Rainbow if 2 or more colors selected
    const rainbowMain = document.getElementById("chk1");
    if (rainbowCount >= 2) {
      if(!rainbowMain.checked) {
        rainbowMain.checked = true;
        saveState("chk1", true);
      }
      if (rainbowCount > 2) {
        bonus += rainbowCount - 2;
      }
    } else {
      if(rainbowMain.checked) {
        rainbowMain.checked = false;
        saveState("chk1", false);
      }
    }

    challenges.forEach(ch => {
      if(ch.id !== 1) {
        if(getState(`chk${ch.id}`)) main++;
      } else {
        // count taste the rainbow from above logic
        if(rainbowMain.checked) main++;
      }

      const bonusCheckbox = document.getElementById(`chk${ch.id}b`);
      if(bonusCheckbox && bonusCheckbox.checked && !bonusCheckbox.disabled) {
        bonus++;
      }
    });

    document.getElementById("main-count").textContent = `‚úîÔ∏è Challenges Completed: ${main} / 10`;
    document.getElementById("bonus-count").textContent = `‚≠ê Bonus Points Earned: ${bonus} / 10`;
    document.getElementById("total-score").textContent = `üèÜ Total Score: ${main + bonus} / 20`;
  }

  document.addEventListener("DOMContentLoaded", () => {
    createChallenges();
    updateScore();

    // Enable/disable bonus checkboxes depending on parent challenge
    document.getElementById("challenge-container").addEventListener("change", (e) => {
      if(e.target && e.target.type === "checkbox") {
        const id = e.target.id;

        // For bonus checkboxes other than sneaky peg (bonusAlwaysEnabled)
        if(id.endsWith("b")) {
          const parentId = id.slice(3, -1);
          const parentChecked = getState(`chk${parentId}`);
          if(!challenges.find(c => c.id === Number(parentId)).bonusAlwaysEnabled) {
            if(!parentChecked) {
              // If parent not checked, disable bonus and uncheck
              e.target.checked = false;
              saveState(id, false);
              e.target.disabled = true;
            } else {
              e.target.disabled = false;
            }
          }
        } else {
          // For parent challenge checkboxes (except Taste the Rainbow)
          if(id !== "chk1") {
            const bonusCheckbox = document.getElementById(id + "b");
            if(bonusCheckbox && !challenges.find(c => c.id === Number(id)).bonusAlwaysEnabled) {
              bonusCheckbox.disabled = !e.target.checked;
              if(!e.target.checked) {
                bonusCheckbox.checked = false;
                saveState(id + "b", false);
              }
            }
          }
        }

        updateScore();
      }
    });
  });
</script>

</body>
</html>
